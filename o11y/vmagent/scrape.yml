global:
  scrape_interval: 5s
  scrape_timeout: 4s

scrape_configs:
  - job_name: exchange
    metrics_path: /metrics
    docker_sd_configs:
      - host: unix:///var/run/docker.sock
    relabel_configs:
      # Keep only containers created by docker-compose for the "exchange" service
      - source_labels: [__meta_docker_container_label_com_docker_compose_service]
        regex: exchange
        action: keep

      # Prefer the container name as instance label
      - source_labels: [__meta_docker_container_name]
        regex: "/(.*)"
        target_label: instance

      # Scrape the container's IP on port 8080
      - source_labels: [__meta_docker_container_network_ip]
        regex: "(.+)"
        target_label: __address__
        replacement: "$1:8080"

  - job_name: cadvisor
    metrics_path: /metrics
    static_configs:
      - targets: ["cadvisor:8080"]
